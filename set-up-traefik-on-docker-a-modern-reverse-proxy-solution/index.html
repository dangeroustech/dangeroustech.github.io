<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Set Up Traefik on Docker - A Modern Reverse Proxy Solution | Dangerous.Tech</title><meta name=keywords content="traefik,ssl,tls,reverse proxy"><meta name=description content="Configure Traefik to run in a docker container to provide reverse proxy services for the rest of your containers!"><meta name=author content="Josh J"><link rel=canonical href=https://dangerous.tech/set-up-traefik-on-docker-a-modern-reverse-proxy-solution/><meta name=google-site-verification content="UrkXfbKDvbQe2Rq2lYKFj4-uHVOHtSzsmpnCXEs2ewI"><link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dangerous.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dangerous.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dangerous.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://dangerous.tech/apple-touch-icon.png><link rel=mask-icon href=https://dangerous.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.107.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3139375174722237" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0WYY8QEMJT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0WYY8QEMJT",{anonymize_ip:!1})}</script><meta property="og:title" content="Set Up Traefik on Docker - A Modern Reverse Proxy Solution"><meta property="og:description" content="Configure Traefik to run in a docker container to provide reverse proxy services for the rest of your containers!"><meta property="og:type" content="article"><meta property="og:url" content="https://dangerous.tech/set-up-traefik-on-docker-a-modern-reverse-proxy-solution/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-01T00:00:00+00:00"><meta property="og:site_name" content="Dangerous.Tech"><meta name=twitter:card content="summary"><meta name=twitter:title content="Set Up Traefik on Docker - A Modern Reverse Proxy Solution"><meta name=twitter:description content="Configure Traefik to run in a docker container to provide reverse proxy services for the rest of your containers!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dangerous.tech/posts/"},{"@type":"ListItem","position":2,"name":"Set Up Traefik on Docker - A Modern Reverse Proxy Solution","item":"https://dangerous.tech/set-up-traefik-on-docker-a-modern-reverse-proxy-solution/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Set Up Traefik on Docker - A Modern Reverse Proxy Solution","name":"Set Up Traefik on Docker - A Modern Reverse Proxy Solution","description":"Configure Traefik to run in a docker container to provide reverse proxy services for the rest of your containers!","keywords":["traefik","ssl","tls","reverse proxy"],"articleBody":"For many years, I used NGINX as a reverse proxy. It’s pretty bulletproof as long as you have your configuration set up properly from the get-go. There’s even a number of ways to automatially create new SSL certs for new containers but this mostly has to be done in a separate container itself. This makes the process of upgrading, testing, rolling back, patching and whatnot a bit of a mither. Enter Traefik.\nIf you saw the comparison post on why I chose Traefik vs Caddy then you’ll know I liked both of them, but I’m glad that I made the choice that I did. Since that post, Traefik has gone fully 2.0, updated a lot of their documentaion and just keeps getting better and better. I will still keep a cursory eye on Caddy but I doubt I’ll be switching over any time soon.\nTraefik support the defining of configuration via command line arguments or via a TOML file. To keep things simple and not require the backing up of an extra file, I run my container with command line arguments. This means all of the config is stored within the docker-compose file and makes it rather easy to share. The full config will be at the end of the post, but for now, let’s go through it in smaller chunks.\nTraefik Container Walkthrough version: \"3.3\" services: traefik: container_name: traefik image: traefik:v2.2.0 command: Obviously this is just the headings and whatnot, what you name the service/container is up to you. The key bit is that you should peg your container to an actual version, not just latest, to save upgrading your container in the future and encountering breaking changes which destroys your reverse proxy. You will get log messages from time to time about upgrades if they are available. The command section is where we pass the command line arguments to the Traefik binary that will run in the container.\n#- --log.level=DEBUG Useful if you need to debug/troubleshoot your config (obviously) but it does produce a LOT of noise so disable once you’re up and running.\n# Entrypoints - --entrypoints.http.address=:80 - --entrypoints.https.address=:443 Entrypoints are essentially where you’re expecting traffic to come in to Traefik. Here, we set the address of an entrypoint called http and https to their relevant ports. You could very well define - --entrypoints.irc.address=:6697 if you liked.\n# Provider Info - --providers.docker Again, self-explannatory really. This tells Traefik that we’re dealing with docker containers. There are plenty of other supported providers out there too.\n# Certificate Resolver Info - --certificatesresolvers.le.acme.email=your@email.domain - --certificatesresolvers.le.acme.storage=/letsencrypt/acme.json - --certificatesresolvers.le.acme.tlschallenge=true This is probably my favourite part, the auto SSL cert retrieval. The le portion is configurable and this is what you’ll reference in your container setups, along with a Host(`sub.domain.tld`) rule. See the bottom of this post for an example using my Jenkins container.\nThat’s it for the basics, really. But, because I’m usually not content with the basics, here’s some more advanced config.\nlabels: # Middleware Redirect - \"traefik.http.middlewares.https-redirect.redirectscheme.scheme=https\" # Global HTTP -\u003e HTTPS Redirect - \"traefik.http.routers.redirs.rule=hostregexp(`{host:.+}`)\" - \"traefik.http.routers.redirs.entrypoints=http\" - \"traefik.http.routers.redirs.middlewares=https-redirect\" This section creates a middleware element and a router to redirect all HTTP traffic to HTTPS. Setting this as a label on the Traefik container itself means that you don’t have to create individual middleware for each new container and then add the redir config into those containers routers in order for this to function. Much simpler and I haven’t found a problem with it thus far (I’m running 8-10 containers at any one time).\nports: - \"80:80\" - \"443:443\" volumes: - \"/var/run/docker.sock:/var/run/docker.sock\" - \"certs:/letsencrypt\" restart: unless-stopped networks: - proxy volumes: certs: networks: proxy: driver: bridge The end part is all fairly self-explannatory too, if you’ve worked with containers before. We set up a volume to hold our certs JSON file, and we create the proxy network, which on my host is the only network which communicates with the outside world. We need to bind port 80 and 443 to this container because they will always be handling the public traffic routing, that’ kind of what a reverse proxy is for…\nBy virtue of the --provider=docker flag we went through earlier, Traefik knows that it should be looking for containers on this network so that’s what it will check when it receives new events from the /var/run/docker.sock which we’ve allowed it to see. That means that you don’t have to expose port 80 of 443 in the individual containers’ docker-compose.yml files, you just have to add a few labels to point Traefik in the right direction (and yes, it supports external -\u003e internal port redirection too so those containers with fixed internal ports can be mapped just fine).\nClient Container Walkthrough We’ll leave out the boring headers this time, the same advice applies from the Traefik header portion.\nlabels: - \"traefik.enable=true\" - \"traefik.http.routers.jenkins.entrypoints=https\" - \"traefik.http.routers.jenkins.rule=Host(`sub.domain.tld`)\" - \"traefik.http.routers.jenkins.tls.certresolver=le\" - \"traefik.http.services.jenkins.loadbalancer.server.port=8080\" The labels section is the key bit of client config we need for Traefik. This tells Traefik to enable this container for reverse proxy goodness, to use our entrypoint (https) and out certresolver (le) which we defined earlier, as well as uses the Host(`sub.domain.tld`) rule.\nThe new thing here is the loadbalancer rule, which is how you can enable the external -\u003e internal port mapping that I mentioned earlier. This will cause cause Traefik to route incoming traffic on the entrypoint (https/:443 here) to the specified internal port (8080 here) of the container.\nnetworks: - traefik_proxy networks: traefik_proxy: external: true Here we make sure that the container has the traefik_proxy network attached as an external network. This was defined in the Traefik container simply as proxy but Docker references these things like so: service_thing so if you run docker network list then you’ll see the correct network to add. You can also run docker network inspect your_proxy_network and look at the \"Containers\" key to see that the traefik container is in there.\nFull Traefik Container YAML version: \"3.3\" services: traefik: container_name: traefik image: traefik:v2.2.0 command: #- --log.level=DEBUG # Entrypoints - --entrypoints.http.address=:80 - --entrypoints.https.address=:443 # Provider Info - --providers.docker # Certificate Resolver Info - --certificatesresolvers.le.acme.email=your@email.domain - --certificatesresolvers.le.acme.storage=/letsencrypt/acme.json - --certificatesresolvers.le.acme.tlschallenge=true labels: # Middleware Redirect - \"traefik.http.middlewares.https-redirect.redirectscheme.scheme=https\" # Global HTTP -\u003e HTTPS Redirect - \"traefik.http.routers.redirs.rule=hostregexp(`{host:.+}`)\" - \"traefik.http.routers.redirs.entrypoints=http\" - \"traefik.http.routers.redirs.middlewares=https-redirect\" ports: - \"80:80\" - \"443:443\" volumes: - \"/var/run/docker.sock:/var/run/docker.sock\" - \"certs:/letsencrypt\" restart: unless-stopped networks: - proxy volumes: certs: networks: proxy: driver: bridge Full Client (Jenkins) Container Walkthrough version: '3' services: jenkins: container_name: jenkins image: jenkins/jenkins:lts restart: unless-stopped labels: - \"traefik.enable=true\" - \"traefik.http.routers.jenkins.entrypoints=https\" - \"traefik.http.routers.jenkins.rule=Host(`sub.domain.tld`)\" - \"traefik.http.routers.jenkins.tls.certresolver=le\" - \"traefik.http.services.jenkins.loadbalancer.server.port=8080\" volumes: - jenkins_home:/var/jenkins_home networks: - traefik_proxy volumes: jenkins_home: networks: traefik_proxy: external: true ","wordCount":"1093","inLanguage":"en","datePublished":"2020-06-01T00:00:00Z","dateModified":"2020-06-01T00:00:00Z","author":{"@type":"Person","name":"Josh J"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dangerous.tech/set-up-traefik-on-docker-a-modern-reverse-proxy-solution/"},"publisher":{"@type":"Organization","name":"Dangerous.Tech","logo":{"@type":"ImageObject","url":"https://dangerous.tech/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dangerous.tech/ accesskey=h title="Dangerous.Tech (Alt + H)">Dangerous.Tech</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://dangerous.tech/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://dangerous.tech/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dangerous.tech/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/dangeroustech title=GitHub><span>GitHub</span></a></li><li><a href=https://dangerous.tech/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dangerous.tech/>Home</a>&nbsp;»&nbsp;<a href=https://dangerous.tech/posts/>Posts</a></div><h1 class=post-title>Set Up Traefik on Docker - A Modern Reverse Proxy Solution</h1><div class=post-description>Configure Traefik to run in a docker container to provide reverse proxy services for the rest of your containers!</div><div class=post-meta>June 1, 2020&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Josh J</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#traefik-container-walkthrough aria-label="Traefik Container Walkthrough">Traefik Container Walkthrough</a></li><li><a href=#client-container-walkthrough aria-label="Client Container Walkthrough">Client Container Walkthrough</a><ul><li><a href=#full-traefik-container-yaml aria-label="Full Traefik Container YAML">Full Traefik Container YAML</a></li><li><a href=#full-client-jenkins-container-walkthrough aria-label="Full Client (Jenkins) Container Walkthrough">Full Client (Jenkins) Container Walkthrough</a></li></ul></li></ul></div></details></div><div class=post-content><p>For many years, I used <a href=https://github.com/dangeroustech/docker-composes/tree/master/proxy>NGINX as a reverse proxy.</a> It&rsquo;s pretty bulletproof as long as you have your configuration set up properly from the get-go. There&rsquo;s even a number of ways to automatially create new SSL certs for new containers but this mostly has to be done in a separate container itself. This makes the process of upgrading, testing, rolling back, patching and whatnot a bit of a mither. Enter Traefik.</p><p>If you saw the comparison post on <a href=https://dangerous.tech/selecting-a-new-reverse-proxy-caddy-or-traefik/>why I chose Traefik vs Caddy</a> then you&rsquo;ll know I liked both of them, but I&rsquo;m glad that I made the choice that I did. Since that post, Traefik has gone fully 2.0, updated a lot of their documentaion and just keeps getting better and better. I will still keep a cursory eye on Caddy but I doubt I&rsquo;ll be switching over any time soon.</p><p>Traefik support the defining of configuration via command line arguments or via a TOML file. To keep things simple and not require the backing up of an extra file, I run my container with command line arguments. This means all of the config is stored within the <code>docker-compose</code> file and makes it rather easy to share. The full config will be at the end of the post, but for now, let&rsquo;s go through it in smaller chunks.</p><h2 id=traefik-container-walkthrough>Traefik Container Walkthrough<a hidden class=anchor aria-hidden=true href=#traefik-container-walkthrough>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>version: <span style=color:#e6db74>&#34;3.3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  traefik:
</span></span><span style=display:flex><span>    container_name: traefik
</span></span><span style=display:flex><span>    image: traefik:v2.2.0
</span></span><span style=display:flex><span>    command:
</span></span></code></pre></div><p>Obviously this is just the headings and whatnot, what you name the service/container is up to you. The key bit is that you <em>should</em> peg your container to an actual version, not just latest, to save upgrading your container in the future and encountering breaking changes which destroys your reverse proxy. You will get log messages from time to time about upgrades if they are available. The <code>command</code> section is where we pass the command line arguments to the Traefik binary that will run in the container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#- --log.level=DEBUG</span>
</span></span></code></pre></div><p>Useful if you need to debug/troubleshoot your config (obviously) but it does produce a LOT of noise so disable once you&rsquo;re up and running.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Entrypoints</span>
</span></span><span style=display:flex><span>      - --entrypoints.http.address<span style=color:#f92672>=</span>:80
</span></span><span style=display:flex><span>      - --entrypoints.https.address<span style=color:#f92672>=</span>:443
</span></span></code></pre></div><p>Entrypoints are essentially where you&rsquo;re expecting traffic to come in to Traefik. Here, we set the address of an entrypoint called http and https to their relevant ports. You could very well define <code>- --entrypoints.irc.address=:6697</code> if you liked.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Provider Info</span>
</span></span><span style=display:flex><span>      - --providers.docker
</span></span></code></pre></div><p>Again, self-explannatory really. This tells Traefik that we&rsquo;re dealing with docker containers. There are plenty of other <a href=https://docs.traefik.io/providers/overview/>supported providers</a> out there too.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Certificate Resolver Info</span>
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.email<span style=color:#f92672>=</span>your@email.domain
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.storage<span style=color:#f92672>=</span>/letsencrypt/acme.json
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.tlschallenge<span style=color:#f92672>=</span>true
</span></span></code></pre></div><p>This is probably my favourite part, the auto SSL cert retrieval. The <code>le</code> portion is configurable and this is what you&rsquo;ll reference in your container setups, along with a <code>Host(`sub.domain.tld`)</code> rule. See the bottom of this post for an example using my Jenkins container.</p><p>That&rsquo;s it for the basics, really. But, because I&rsquo;m usually not content with the basics, here&rsquo;s some more advanced config.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>labels:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Middleware Redirect</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.middlewares.https-redirect.redirectscheme.scheme=https&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Global HTTP -&gt; HTTPS Redirect</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.rule=hostregexp(`{host:.+}`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.entrypoints=http&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.middlewares=https-redirect&#34;</span>
</span></span></code></pre></div><p>This section creates a middleware element and a router to redirect all HTTP traffic to HTTPS. Setting this as a label on the Traefik container itself means that you don&rsquo;t have to create individual middleware for each new container and then add the redir config into those containers routers in order for this to function. Much simpler and I haven&rsquo;t found a problem with it thus far (I&rsquo;m running 8-10 containers at any one time).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ports:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;certs:/letsencrypt&#34;</span>
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    networks:
</span></span><span style=display:flex><span>      - proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  certs:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  proxy:
</span></span><span style=display:flex><span>    driver: bridge
</span></span></code></pre></div><p>The end part is all fairly self-explannatory too, if you&rsquo;ve worked with containers before. We set up a volume to hold our certs JSON file, and we create the <code>proxy</code> network, which on my host is the only network which communicates with the outside world. We need to bind port 80 and 443 to this container because they will always be handling the public traffic routing, that&rsquo; kind of what a reverse proxy is for&mldr;</p><p>By virtue of the <code>--provider=docker</code> flag we went through earlier, Traefik knows that it should be looking for containers on this network so that&rsquo;s what it will check when it receives new events from the <code>/var/run/docker.sock</code> which we&rsquo;ve allowed it to see. That means that you don&rsquo;t have to expose port 80 of 443 in the individual containers&rsquo; <code>docker-compose.yml</code> files, you just have to add a few labels to point Traefik in the right direction (and yes, it supports external -> internal port redirection too so those containers with fixed internal ports can be mapped just fine).</p><h2 id=client-container-walkthrough>Client Container Walkthrough<a hidden class=anchor aria-hidden=true href=#client-container-walkthrough>#</a></h2><p><em>We&rsquo;ll leave out the boring headers this time, the same advice applies from the Traefik header portion.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>labels:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.entrypoints=https&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.rule=Host(`sub.domain.tld`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.tls.certresolver=le&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.services.jenkins.loadbalancer.server.port=8080&#34;</span>
</span></span></code></pre></div><p>The labels section is the key bit of client config we need for Traefik. This tells Traefik to enable this container for reverse proxy goodness, to use our entrypoint (https) and out certresolver (le) which we defined earlier, as well as uses the <code>Host(`sub.domain.tld`)</code> rule.</p><p>The new thing here is the loadbalancer rule, which is how you can enable the external -> internal port mapping that I mentioned earlier. This will cause cause Traefik to route incoming traffic on the entrypoint (https/:443 here) to the specified internal port (8080 here) of the container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>      - traefik_proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  traefik_proxy:
</span></span><span style=display:flex><span>    external: true
</span></span></code></pre></div><p>Here we make sure that the container has the <code>traefik_proxy</code> network attached as an external network. This was defined in the Traefik container simply as <code>proxy</code> but Docker references these things like so: <code>service_thing</code> so if you run <code>docker network list</code> then you&rsquo;ll see the correct network to add. You can also run <code>docker network inspect your_proxy_network</code> and look at the <code>"Containers"</code> key to see that the traefik container is in there.</p><h3 id=full-traefik-container-yaml>Full Traefik Container YAML<a hidden class=anchor aria-hidden=true href=#full-traefik-container-yaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>version: <span style=color:#e6db74>&#34;3.3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  traefik:
</span></span><span style=display:flex><span>    container_name: traefik
</span></span><span style=display:flex><span>    image: traefik:v2.2.0
</span></span><span style=display:flex><span>    command:
</span></span><span style=display:flex><span>      <span style=color:#75715e>#- --log.level=DEBUG</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Entrypoints</span>
</span></span><span style=display:flex><span>      - --entrypoints.http.address<span style=color:#f92672>=</span>:80
</span></span><span style=display:flex><span>      - --entrypoints.https.address<span style=color:#f92672>=</span>:443
</span></span><span style=display:flex><span>      <span style=color:#75715e># Provider Info</span>
</span></span><span style=display:flex><span>      - --providers.docker
</span></span><span style=display:flex><span>      <span style=color:#75715e># Certificate Resolver Info</span>
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.email<span style=color:#f92672>=</span>your@email.domain
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.storage<span style=color:#f92672>=</span>/letsencrypt/acme.json
</span></span><span style=display:flex><span>      - --certificatesresolvers.le.acme.tlschallenge<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Middleware Redirect</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.middlewares.https-redirect.redirectscheme.scheme=https&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Global HTTP -&gt; HTTPS Redirect</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.rule=hostregexp(`{host:.+}`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.entrypoints=http&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.redirs.middlewares=https-redirect&#34;</span>
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;certs:/letsencrypt&#34;</span>
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    networks:
</span></span><span style=display:flex><span>      - proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  certs:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  proxy:
</span></span><span style=display:flex><span>    driver: bridge
</span></span></code></pre></div><h3 id=full-client-jenkins-container-walkthrough>Full Client (Jenkins) Container Walkthrough<a hidden class=anchor aria-hidden=true href=#full-client-jenkins-container-walkthrough>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>version: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  jenkins:
</span></span><span style=display:flex><span>    container_name: jenkins
</span></span><span style=display:flex><span>    image: jenkins/jenkins:lts
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.entrypoints=https&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.rule=Host(`sub.domain.tld`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.jenkins.tls.certresolver=le&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.services.jenkins.loadbalancer.server.port=8080&#34;</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - jenkins_home:/var/jenkins_home
</span></span><span style=display:flex><span>    networks:
</span></span><span style=display:flex><span>      - traefik_proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  jenkins_home:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  traefik_proxy:
</span></span><span style=display:flex><span>    external: true
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://dangerous.tech/tags/traefik/>traefik</a></li><li><a href=https://dangerous.tech/tags/ssl/>ssl</a></li><li><a href=https://dangerous.tech/tags/tls/>tls</a></li><li><a href=https://dangerous.tech/tags/reverse-proxy/>reverse proxy</a></li></ul><nav class=paginav><a class=prev href=https://dangerous.tech/znc--docker-a-containerized-irc-bouncer/><span class=title>« Prev Page</span><br><span>ZNC + Docker - A Containerized IRC Bouncer</span></a>
<a class=next href=https://dangerous.tech/running-a-script-at-login-with-i3/><span class=title>Next Page »</span><br><span>Running a Script at Login with i3</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on twitter" href="https://twitter.com/intent/tweet/?text=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution&url=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f&hashtags=traefik%2cssl%2ctls%2creverseproxy"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f&title=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution&summary=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution&source=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f&title=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on whatsapp" href="https://api.whatsapp.com/send?text=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution%20-%20https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Set Up Traefik on Docker - A Modern Reverse Proxy Solution on telegram" href="https://telegram.me/share/url?text=Set%20Up%20Traefik%20on%20Docker%20-%20A%20Modern%20Reverse%20Proxy%20Solution&url=https%3a%2f%2fdangerous.tech%2fset-up-traefik-on-docker-a-modern-reverse-proxy-solution%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://dangerous.tech/>Dangerous.Tech</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>