<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F | Dangerous.Tech</title>
<meta name=keywords content="hpe,aruba,vsf,stacking,switches"><meta name=description content="A comprehensive guide to setting up and managing VSF stacking on HPE/Aruba 2930F switches"><meta name=author content="Josh J"><link rel=canonical href=https://dangerous.tech/configuring-vsf-virtual-switching-framework-stacking-on-the-hpe/aruba-2930f/><meta name=google-site-verification content="UrkXfbKDvbQe2Rq2lYKFj4-uHVOHtSzsmpnCXEs2ewI"><link crossorigin=anonymous href=/assets/css/stylesheet.4998b7a9bd671844dc2e8a531072d86cea13cf6d69dbad332d2a1e9a104c862f.css integrity="sha256-SZi3qb1nGETcLopTEHLYbOoTz21p260zLSoemhBMhi8=" rel="preload stylesheet" as=style><link rel=icon href=https://dangerous.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dangerous.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dangerous.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://dangerous.tech/apple-touch-icon.png><link rel=mask-icon href=https://dangerous.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dangerous.tech/configuring-vsf-virtual-switching-framework-stacking-on-the-hpe/aruba-2930f/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3139375174722237" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0WYY8QEMJT"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0WYY8QEMJT")}</script><meta property="og:title" content="Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F"><meta property="og:description" content="A comprehensive guide to setting up and managing VSF stacking on HPE/Aruba 2930F switches"><meta property="og:type" content="article"><meta property="og:url" content="https://dangerous.tech/configuring-vsf-virtual-switching-framework-stacking-on-the-hpe/aruba-2930f/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-02T04:00:00+00:00"><meta property="article:modified_time" content="2018-08-02T04:00:00+00:00"><meta property="og:site_name" content="Dangerous.Tech"><meta name=twitter:card content="summary"><meta name=twitter:title content="Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F"><meta name=twitter:description content="A comprehensive guide to setting up and managing VSF stacking on HPE/Aruba 2930F switches"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dangerous.tech/posts/"},{"@type":"ListItem","position":2,"name":"Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F","item":"https://dangerous.tech/configuring-vsf-virtual-switching-framework-stacking-on-the-hpe/aruba-2930f/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F","name":"Configuring VSF (Virtual Switching Framework) Stacking on the HPE\/Aruba 2930F","description":"A comprehensive guide to setting up and managing VSF stacking on HPE/Aruba 2930F switches","keywords":["hpe","aruba","vsf","stacking","switches"],"articleBody":"We have recently begun a project to replace all of our core switches at our various remote locations. We have around 40 locations and 2 core switches for each location so, whilst not the largest undertaking, it’s an operationally significant project for a team of 1… We’ve used HP switches for a long time (we’re even still using some of the 3COM switches…) and we have a supplier that gets a good discount on these so I went shopping. Now that HPE have purchased Aruba, there’s some nicer models that we can get our hands on. We don’t have any stupidly high bandwidth requirements yet either so we’re not looking in the upper ranges, we usually stick to the SMB style switches (plus I have a hard time justifying the price increase with our use cases!).\nThe 2530 or 2540 is the obvious budget model if all you need is Layer 2 and some static routing. It’s the logical follow-on from the likes of the 1910/1920 of old. We’re going to cycle these into our edge when the time comes because they’ll be good workhorse devices for a few years. The 2930 model is where things get interesting for me. Also worth pointing out that the 2920 is cool but is EOL very soon so wasn’t a worthy candidate.\nThe 2930 splits into 2 models:\n2930M - Proper stacking cables, WAY higher PoE outputs, nice layer 3 features - Larger SMB Outfits - Price tag of ~£2.5k (48 port non-PoE) 2930F - VSF stacking, nice layer 3 features - Smaller SMB Outfits - Price Tag of ~£900 (48 port non-PoE) Given the fact that previously, we’ve been paying ~£200 for a HP 1920 switch, a jump to £2.5k is a bit much… The benefits of jumping to ~£900 was justifiable, however. Part of those benefits was the ability to stack the core switches.\nStacking is something that I toyed around with in my university days, using Cisco stacking cables to stack equipment in the lab. It was quite interesting and I could see the benefits of using it (easier switch swap out, better backplane bandwidth, etc). Coming into the industry and joining a company that not only wasn’t using Cisco equipment but was still using unmanaged 3COM switches, the reality was a little different to the fantasy. Due to this, I haven’t had the need to use any stacking for the last 3 or 4 years. When I saw the datasheet for the 2930F had VSF stacking, I started to do some research. The AirHeads forums are surpringly filled with decent information when it comes to this topic, so it didn’t take me long to figure out that I wanted to give this a shot. Queue the supplier sending me 3 2930F’s to test with.\nGetting Started At first, I didn’t see the option for VSF, which wsa a bit startling. Then I realised that I was on a firmware release from a a while back. It would appear that HPE/Aruba introduced the VSF options in firmware from January 2017 so if you need the firmware, search for your switch here and grab the latest. I went from 16.02.0003 to 16.06.0006 in one jump so there’s no interstitial upgrades required. Once the upgrade has been done to the Primary and Secondary BootROMs, you should be back up and running. Now, if you type\nshow vsf you should get the below output.\nAruba-2930F-48G-4SFP(config)# show vsf VSF is not enabled. Good, this means we can begin the config! It’s relatively simple, especially for the first switch.\nAruba-2930F-48G-4SFP(config)# vsf member 1 link 1 2 All configuration on this port has been removed and port is placed in VSF mode. Aruba-2930F-48G-4SFP(config)# vsf member 1 priority 200 Aruba-2930F-48G-4SFP(config)# vsf enable domain 254 This will save the current configuration and reboot the switch. Continue (y/n)? After hitting y at this prompt, the switch will reboot and you should be good to go. To explain some of these options further, domain is simply a number that you give to each set of stacks. Similar to VRRP or HSRP group IDs, basically. Do this part last because it’s the bit of config that triggers a reboot once comitted. The member key specifies which switch you’re operating on in the stack. We’ll see later on but as you add switches, you get members 2, 3 and so on. link is one I haven’t experimented with much yet, basically it seems that you can have 2 virtual ports on the VSF instance. Not sure what significance that has in terms of bandwidth, I’ll investigate that later. The number afterwards is simply the port number that you want to use to stack the ports together. From what I’ve research you can have multiple physical ports on one virtual link but as I mentioned, I haven’t looked much into that yet.\nPost-reboot, you’ll have a new prompt\nAruba-VSF-2930F(config)# which should indicate that VSF is live. You’ll also have an orange light on the port that you set up in the link command.\nIf you need further proof, the show command has some nice output.\nAruba-VSF-2930F(config)# sh vsf VSF Domain ID : 254 MAC Address : 941882-xxxxxx VSF Topology : No Stack Formed VSF Status : Active Uptime : 0d 0h 5m VSF MAD : None VSF Port Speed : 1G Software Version : WC.16.06.0006 Mbr ID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- *1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander This confirms the Member ID, Priority and Status of the switch. I’d recommend changing the hostname at this point to reflect that you’re going to be stacking things, otherwise it may get confusing in the future.\nAruba-VSF-2930F(config)# hostname \"VSF-Test\" VSF-Test(config)# Adding A Switch There’s more than one way to skin a cat when it comes to adding a switch to a VSF fabric. If you have a switch of the same model/firmware as your current commander (not sure how strict that is, see HPE/Aruba for more details), you can just plug the new one into the link port! The new switch will get the VSF config and reboot, then it will join the VSF fabric!\nAruba-2930F-48G-4SFP# Rebooting to join VSF fabric with domain ID 254 Once rebooted, you will be greeted with the commander’s login prompt.\nVSF-Test(config)# Again, the show command will confirm this.\nVSF-Test(config)# sh vsf VSF Domain ID : 254 MAC Address : 941882-xxxxxx VSF Topology : Chain VSF Status : Active Uptime : 0d 0h 17m VSF MAD : None VSF Port Speed : 1G Software Version : WC.16.06.0006 Mbr ID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- 1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander *2 e0071b-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 128 Standby There’s another couple of interesting things about this screen that you’ll notice. We have a switch with ID 2. The star indicates which switch you’re consoled in to, if you are indeed consoled in. You can also see that by default, members join the stack with a priority of 128. We’ll change this shortly. You can also see that the VSF topology is set to chain by default. You can have either chain or ring topologies for your stacking. If you’ve done any stacking before, you’ll be familiar with the concept but if not, chain is just like daisy chaining your switches together whereas ring gives you the ability to have 3 or more switches set up in such a way that if one of the middle switches fails, you’ll still be able to use all of the other switches. In a chain you would lose every switch in the chain beyond the failed switch.\nWe’d better change that priority as well, because it’s usually better to have control of these things.\nVSF-Test(config)# vsf member 2 priority 190 Replacing a Stack Member An interesting scenario that I had was replacing a stack member. As the operational overhead of configuring a new switch was one of the reasons for looking at stacking in the first place, this was a fairly key test. If we look at the running config of our VSF fabric now we get the following.\nhostname \"VSF-Test\" vsf enable domain 254 member 1 type \"JL260A\" mac-address 941882-xxxxxx priority 200 link 1 1/2 link 1 name \"I-Link1_1\" link 2 name \"I-Link1_2\" exit member 2 type \"JL260A\" mac-address e0071b-xxxxxx priority 190 link 1 2/2 link 1 name \"I-Link2_1\" link 2 name \"I-Link2_2\" exit port-speed 1g Besides the link 1 and 2 thing which irks me (no vsf member 1 link 2 to remove that by the way), we can see that each member appears to be bound by a MAC address. This posed an interesting question as to what would happen if we swap out a failed stack member with a new switch. Let’s find out!\nFirstly, we’re greeted by the orange light over the VSF port again. We also get an orange heatbeat symbol!\nThe switch is clearly quite sad that we’ve unplugged it’s stack buddy. If we check the logging with sh logging -r we can see some more info.\nI 01/01/90 00:36:35 04992 vsf: ST1-CMDR: VSF port 1/2 is down I 01/01/90 00:36:35 03271 stacking: ST1-CMDR: Topology is a Standalone I 01/01/90 00:36:35 03272 stacking: ST1-CMDR: Stack fragment active W 01/01/90 00:36:35 03258 stacking: ST1-CMDR: Standby switch with Member ID 2 removed due to loss of communication I 01/01/90 00:36:35 04992 vsf: ST1-CMDR: VSF link 1 is down I 01/01/90 00:36:35 04992 vsf: ST1-CMDR: VSF port 1/2 is in error state Luckily, I’ve got a 3rd switch ready to jump into the fray! After plugging the new one into the same port and waiting for it to reboot, we get some more log info.\nI 01/01/90 00:43:11 00539 stacking: ST1-CMDR: Initial sync to standby starting I 01/01/90 00:43:10 00256 ports: ST1-CMDR: Port 3/2 is reserved for VSF use W 01/01/90 00:43:10 03270 stacking: ST1-CMDR: Topology is a Chain I 01/01/90 00:43:10 02555 chassis: ST1-CMDR: Co-processor Ready I 01/01/90 00:43:08 03125 mgr: ST1-CMDR: Startup configuration changed by SNMP. New seq. number 5 I 01/01/90 00:43:08 03803 chassis: ST1-CMDR: System Self test completed on 3/1-52 W 01/01/90 00:43:08 03270 stacking: ST1-CMDR: Topology is a Chain I 01/01/90 00:43:07 03279 stacking: ST1-CMDR: Member 3 (e0071b-xxxxyy) chosen as standby. Reason: Only available standby I 01/01/90 00:43:07 04992 vsf: ST1-CMDR: VSF link 1 is up I 01/01/90 00:43:02 04987 vsf: ST1-CMDR: VSF link 1 up: Peer has mac e0071b-xxxxyy I 01/01/90 00:43:02 04988 vsf: ST1-CMDR: VSF link 1 port 1/2 up: Peer validated Looks like we’re syncing the initial config which is always nice. The major problem that I can see here is that Port 3/2 is reserved for VSF use. Now, that first number indicates the chassis number, in VSF that would be the same as our member ID. Previously, we only had 1 and 2, now we appear to have a 3rd… Looking at the show command, we get the bad news. The eagle eyed amongst you will also notice that I’m masking the MAC address with y’s for the 3rd switch. This will continue going forwards so that we know which switch is which.\nVSF-Test(config)# sh vsf VSF Domain ID : 254 MAC Address : 941882-xxxxxx VSF Topology : Chain VSF Status : Fragment Active Uptime : 0d 0h 46m VSF MAD : None VSF Port Speed : 1G Software Version : WC.16.06.0006 Mbr ID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- *1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander 2 e0071b-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 190 Missing 3 e0071b-xxxxyy Aruba JL260A 2930F-48G-4SFP Switch 128 Standby Hmm… If you remember the running config output from earlier, you’ll remember that the MAC address was set as a command. Let’s give that a try.\nVSF-Test(config)# vsf member 2 type \"JL260A\" mac-address e0071b-xxxxyy This will save the current configuration. Continue (y/n)? y A switch with the specified MAC address already exists. Oops, no joy there. The list of options available for the VSF member isn’t extensive either.\nVSF-Test(config)# vsf member 3 link Create an VSF link on the specified member. priority Assign a priority to the specified VSF virtual chassis member. remove Erase the VSF virtual chassis member configuration. shutdown Shut down the VSF virtual chassis member. type Configure the family of the VSF member-switch being provisioned. Now, as we’re replacing a member that should have configuration on, we can’t just remove member 2 and re-add it. Here’s the cleanest way I’ve found to do this (pro tip: for future break fixes, don’t get this far. Have the break/fix engineer swapping out your kit give you the MAC of the new switch before plugging it in, that way you can do this without the extra steps).\nRemove the new member with vsf member 3 remove. You’ll get a complaint from the switch but such is life.\nThe specified VSF virtual chassis standby member will be removed and its configuration will be erased. The resulting configuration will be saved. The VSF standby member will be shutdown. Continue (y/n)? y Now you should be able to run the vsf member 2 type \"JL260A\" mac-address e0071b-xxxxyy command that failed earlier. Your status will show as provisioned in sh vsf.\nID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- *1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander 2 e0071b-xxxxyy Aruba JL260A 2930F-48G-4SFP Switch 190 Provisioned Have a kind human (or break/fix engineer, whatever is available) hard reboot the new switch. Not ideal, I’m aware. Short of separating the 2, manually connecting to the new switch and factory resetting it, this is the best way I’ve found.\nWelcome your new stack member into the fold!\nI 01/01/90 01:04:41 00539 stacking: ST1-CMDR: Initial sync to standby starting I 01/01/90 01:04:40 00256 ports: ST1-CMDR: Port 2/2 is reserved for VSF use W 01/01/90 01:04:40 03270 stacking: ST1-CMDR: Topology is a Chain I 01/01/90 01:04:40 02555 chassis: ST1-CMDR: Co-processor Ready I 01/01/90 01:04:38 03803 chassis: ST1-CMDR: System Self test completed on 2/1-52 W 01/01/90 01:04:38 03270 stacking: ST1-CMDR: Topology is a Chain I 01/01/90 01:04:38 03125 mgr: ST1-CMDR: Startup configuration changed by SNMP. New seq. number 7 I 01/01/90 01:04:38 03279 stacking: ST1-CMDR: Member 2 (e0071b-xxxxyy) chosen as standby. Reason: Only available standby I 01/01/90 01:04:38 04992 vsf: ST1-CMDR: VSF link 1 is up I 01/01/90 01:04:33 04987 vsf: ST1-CMDR: VSF link 1 up: Peer has mac e0071b-xxxxyy I 01/01/90 01:04:33 04988 vsf: ST1-CMDR: VSF link 1 port 1/2 up: Peer validated ID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- *1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander 2 e0071b-xxxxyy Aruba JL260A 2930F-48G-4SFP Switch 190 Standby Booting ID MAC Address Model Pri Status --- ----------------- ------------------------------------- --- --------------- *1 941882-xxxxxx Aruba JL260A 2930F-48G-4SFP Switch 200 Commander 2 e0071b-xxxxyy Aruba JL260A 2930F-48G-4SFP Switch 190 Standby Now you can continue on with your day, safe in the knowledge that the P1, 4 Hour Fix call you were working on is resolved. Good Job!\nWord To The Wise The smart way to do this is to get the break/fix engineer to phone you before they get to the site. Then, they can provide you with the MAC address from the side of the box, as seen below.\nThat way, you can run the vsf member 2 type \"JL260A\" mac-address e0071b-xxxxyy command well before there is ever the mention of a 3rd member.\n","wordCount":"2559","inLanguage":"en","datePublished":"2018-08-02T04:00:00Z","dateModified":"2018-08-02T04:00:00Z","author":{"@type":"Person","name":"Josh J"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dangerous.tech/configuring-vsf-virtual-switching-framework-stacking-on-the-hpe/aruba-2930f/"},"publisher":{"@type":"Organization","name":"Dangerous.Tech","logo":{"@type":"ImageObject","url":"https://dangerous.tech/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dangerous.tech/ accesskey=h title="Dangerous.Tech (Alt + H)">Dangerous.Tech</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dangerous.tech/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://dangerous.tech/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dangerous.tech/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/dangeroustech title=GitHub><span>GitHub</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://dangerous.tech/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dangerous.tech/>Home</a>&nbsp;»&nbsp;<a href=https://dangerous.tech/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F</h1><div class=post-description>A comprehensive guide to setting up and managing VSF stacking on HPE/Aruba 2930F switches</div><div class=post-meta><span title='2018-08-02 04:00:00 +0000 UTC'>August 2, 2018</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;Josh J</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#getting-started aria-label="Getting Started">Getting Started</a></li><li><a href=#adding-a-switch aria-label="Adding A Switch">Adding A Switch</a></li><li><a href=#replacing-a-stack-member aria-label="Replacing a Stack Member">Replacing a Stack Member</a><ul><li><a href=#word-to-the-wise aria-label="Word To The Wise">Word To The Wise</a></li></ul></li></ul></div></details></div><div class=post-content><p>We have recently begun a project to replace all of our core switches at our various remote locations. We have around 40 locations and 2 core switches for each location so, whilst not the largest undertaking, it&rsquo;s an operationally significant project for a team of 1&mldr; We&rsquo;ve used HP switches for a long time (we&rsquo;re even still using some of the 3COM switches&mldr;) and we have a supplier that gets a good discount on these so I went shopping. Now that HPE have purchased Aruba, there&rsquo;s some nicer models that we can get our hands on. We don&rsquo;t have any stupidly high bandwidth requirements yet either so we&rsquo;re not looking in the upper ranges, we usually stick to the SMB style switches (plus I have a hard time justifying the price increase with our use cases!).</p><p>The <a href=https://www.arubanetworks.com/products/networking/switches/2530-series/>2530</a> or <a href=https://www.arubanetworks.com/products/networking/switches/2540-series/>2540</a> is the obvious budget model if all you need is Layer 2 and some static routing. It&rsquo;s the logical follow-on from the likes of the 1910/1920 of old. We&rsquo;re going to cycle these into our edge when the time comes because they&rsquo;ll be good workhorse devices for a few years. The <a href=https://www.arubanetworks.com/products/networking/switches/2930f-series/>2930</a> model is where things get interesting for me. Also worth pointing out that the 2920 is cool but is EOL very soon so wasn&rsquo;t a worthy candidate.</p><p>The 2930 splits into 2 models:</p><ul><li>2930M - Proper stacking cables, WAY higher PoE outputs, nice layer 3 features - Larger SMB Outfits - Price tag of ~£2.5k (48 port non-PoE)</li><li>2930F - VSF stacking, nice layer 3 features - Smaller SMB Outfits - Price Tag of ~£900 (48 port non-PoE)</li></ul><p>Given the fact that previously, we&rsquo;ve been paying ~£200 for a HP 1920 switch, a jump to £2.5k is a bit much&mldr; The benefits of jumping to ~£900 was justifiable, however. Part of those benefits was the ability to stack the core switches.</p><p>Stacking is something that I toyed around with in my university days, using Cisco stacking cables to stack equipment in the lab. It was quite interesting and I could see the benefits of using it (easier switch swap out, better backplane bandwidth, etc). Coming into the industry and joining a company that not only wasn&rsquo;t using Cisco equipment but was still using unmanaged 3COM switches, the reality was a little different to the fantasy. Due to this, I haven&rsquo;t had the need to use any stacking for the last 3 or 4 years. When I saw the <a href=https://www.arubanetworks.com/assets/ds/DS_2930FSwitchSeries.pdf>datasheet for the 2930F</a> had <a href=http://h22208.www2.hpe.com/eginfolib/networking/docs/switches/K-KA-KB/16-01/5200-0137_MCG/content/ch19.html>VSF stacking</a>, I started to do some research. The AirHeads forums are surpringly filled with <a href=http://community.arubanetworks.com/t5/Learning/Configure-Virtual-Switching-Framework-VSF-the-easy-way/td-p/299916>decent information</a> when it comes to this topic, so it didn&rsquo;t take me long to figure out that I wanted to give this a shot. Queue the supplier sending me 3 2930F&rsquo;s to test with.</p><h2 id=getting-started>Getting Started<a hidden class=anchor aria-hidden=true href=#getting-started>#</a></h2><p>At first, I didn&rsquo;t see the option for VSF, which wsa a bit startling. Then I realised that I was on a firmware release from a a while back. It would appear that HPE/Aruba introduced the VSF options in firmware from <a href=https://community.arubanetworks.com/t5/Controllerless-Networks/stacking-in-2930F/td-p/273342>January 2017</a> so if you need the firmware, <a href="https://h10145.www1.hpe.com/downloads/ProductsList.aspx?lang=&amp;cc=&amp;prodSeriesId=">search for your switch here</a> and grab the latest. I went from 16.02.0003 to 16.06.0006 in one jump so there&rsquo;s no interstitial upgrades required. Once the upgrade has been done to the Primary and Secondary BootROMs, you should be back up and running. Now, if you type</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>show vsf
</span></span></code></pre></div><p>you should get the below output.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-2930F-48G-4SFP<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># show vsf</span>
</span></span><span style=display:flex><span>VSF is not enabled.
</span></span></code></pre></div><p>Good, this means we can begin the config! It&rsquo;s relatively simple, especially for the first switch.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-2930F-48G-4SFP<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf member 1 link 1 2</span>
</span></span><span style=display:flex><span>All configuration on this port has been removed and port is placed in VSF mode.
</span></span><span style=display:flex><span>Aruba-2930F-48G-4SFP<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf member 1 priority 200</span>
</span></span><span style=display:flex><span>Aruba-2930F-48G-4SFP<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf enable domain 254</span>
</span></span><span style=display:flex><span>This will save the current configuration and reboot the switch.
</span></span><span style=display:flex><span>Continue <span style=color:#f92672>(</span>y/n<span style=color:#f92672>)</span>?
</span></span></code></pre></div><p>After hitting <code>y</code> at this prompt, the switch will reboot and you should be good to go. To explain some of these options further, <code>domain</code> is simply a number that you give to each set of stacks. Similar to VRRP or HSRP group IDs, basically. Do this part last because it&rsquo;s the bit of config that triggers a reboot once comitted. The <code>member</code> key specifies which switch you&rsquo;re operating on in the stack. We&rsquo;ll see later on but as you add switches, you get members 2, 3 and so on. <code>link</code> is one I haven&rsquo;t experimented with much yet, basically it seems that you can have 2 virtual ports on the VSF instance. Not sure what significance that has in terms of bandwidth, I&rsquo;ll investigate that later. The number afterwards is simply the port number that you want to use to stack the ports together. From what I&rsquo;ve research you can have multiple physical ports on one virtual link but as I mentioned, I haven&rsquo;t looked much into that yet.</p><p>Post-reboot, you&rsquo;ll have a new prompt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-VSF-2930F<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><p>which should indicate that VSF is live. You&rsquo;ll also have an orange light on the port that you set up in the <code>link</code> command.</p><p>If you need further proof, the <code>show</code> command has some nice output.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-VSF-2930F<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># sh vsf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> VSF Domain ID    : <span style=color:#ae81ff>254</span>
</span></span><span style=display:flex><span> MAC Address      : 941882-xxxxxx
</span></span><span style=display:flex><span> VSF Topology     : No Stack Formed
</span></span><span style=display:flex><span> VSF Status       : Active
</span></span><span style=display:flex><span> Uptime           : 0d 0h 5m
</span></span><span style=display:flex><span> VSF MAD          : None
</span></span><span style=display:flex><span> VSF Port Speed   : 1G
</span></span><span style=display:flex><span> Software Version : WC.16.06.0006
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Mbr
</span></span><span style=display:flex><span> ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span> --- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span> *1  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span></code></pre></div><p>This confirms the Member ID, Priority and Status of the switch. I&rsquo;d recommend changing the hostname at this point to reflect that you&rsquo;re going to be stacking things, otherwise it may get confusing in the future.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-VSF-2930F<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># hostname &#34;VSF-Test&#34;</span>
</span></span><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><h2 id=adding-a-switch>Adding A Switch<a hidden class=anchor aria-hidden=true href=#adding-a-switch>#</a></h2><p>There&rsquo;s more than one way to skin a cat when it comes to adding a switch to a VSF fabric. If you have a switch of the same model/firmware as your current commander (not sure how strict that is, see HPE/Aruba for more details), you can just plug the new one into the <code>link</code> port! The new switch will get the VSF config and reboot, then it will join the VSF fabric!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Aruba-2930F-48G-4SFP#
</span></span><span style=display:flex><span>Rebooting to join VSF fabric with domain ID <span style=color:#ae81ff>254</span>
</span></span></code></pre></div><p>Once rebooted, you will be greeted with the commander&rsquo;s login prompt.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><p>Again, the <code>show</code> command will confirm this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># sh vsf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> VSF Domain ID    : <span style=color:#ae81ff>254</span>
</span></span><span style=display:flex><span> MAC Address      : 941882-xxxxxx
</span></span><span style=display:flex><span> VSF Topology     : Chain
</span></span><span style=display:flex><span> VSF Status       : Active
</span></span><span style=display:flex><span> Uptime           : 0d 0h 17m
</span></span><span style=display:flex><span> VSF MAD          : None
</span></span><span style=display:flex><span> VSF Port Speed   : 1G
</span></span><span style=display:flex><span> Software Version : WC.16.06.0006
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Mbr
</span></span><span style=display:flex><span> ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span> --- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span>  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span><span style=display:flex><span> *2  e0071b-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>128</span> Standby
</span></span></code></pre></div><p>There&rsquo;s another couple of interesting things about this screen that you&rsquo;ll notice. We have a switch with ID 2. The star indicates which switch you&rsquo;re consoled in to, if you are indeed consoled in. You can also see that by default, members join the stack with a priority of 128. We&rsquo;ll change this shortly. You can also see that the VSF topology is set to <code>chain</code> by default. You can have either <code>chain</code> or <code>ring</code> topologies for your stacking. If you&rsquo;ve done any stacking before, you&rsquo;ll be familiar with the concept but if not, chain is just like daisy chaining your switches together whereas ring gives you the ability to have 3 or more switches set up in such a way that if one of the middle switches fails, you&rsquo;ll still be able to use all of the other switches. In a <code>chain</code> you would lose every switch in the chain beyond the failed switch.</p><p>We&rsquo;d better change that priority as well, because it&rsquo;s usually better to have control of these things.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf member 2 priority 190</span>
</span></span></code></pre></div><h2 id=replacing-a-stack-member>Replacing a Stack Member<a hidden class=anchor aria-hidden=true href=#replacing-a-stack-member>#</a></h2><p>An interesting scenario that I had was replacing a stack member. As the operational overhead of configuring a new switch was one of the reasons for looking at stacking in the first place, this was a fairly key test. If we look at the running config of our VSF fabric now we get the following.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>hostname <span style=color:#e6db74>&#34;VSF-Test&#34;</span>
</span></span><span style=display:flex><span>vsf
</span></span><span style=display:flex><span>   enable domain <span style=color:#ae81ff>254</span>
</span></span><span style=display:flex><span>   member <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      type <span style=color:#e6db74>&#34;JL260A&#34;</span> mac-address 941882-xxxxxx
</span></span><span style=display:flex><span>      priority <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>1</span> 1/2
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>1</span> name <span style=color:#e6db74>&#34;I-Link1_1&#34;</span>
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>2</span> name <span style=color:#e6db74>&#34;I-Link1_2&#34;</span>
</span></span><span style=display:flex><span>      exit
</span></span><span style=display:flex><span>   member <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      type <span style=color:#e6db74>&#34;JL260A&#34;</span> mac-address e0071b-xxxxxx
</span></span><span style=display:flex><span>      priority <span style=color:#ae81ff>190</span>
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>1</span> 2/2
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>1</span> name <span style=color:#e6db74>&#34;I-Link2_1&#34;</span>
</span></span><span style=display:flex><span>      link <span style=color:#ae81ff>2</span> name <span style=color:#e6db74>&#34;I-Link2_2&#34;</span>
</span></span><span style=display:flex><span>      exit
</span></span><span style=display:flex><span>   port-speed 1g
</span></span></code></pre></div><p>Besides the link 1 and 2 thing which irks me (<code>no vsf member 1 link 2</code> to remove that by the way), we can see that each member appears to be bound by a MAC address. This posed an interesting question as to what would happen if we swap out a failed stack member with a new switch. Let&rsquo;s find out!</p><p>Firstly, we&rsquo;re greeted by the orange light over the VSF port again. We also get an orange heatbeat symbol!</p><p>The switch is clearly quite sad that we&rsquo;ve unplugged it&rsquo;s stack buddy. If we check the logging with <code>sh logging -r</code> we can see some more info.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>I 01/01/90 00:36:35 <span style=color:#ae81ff>04992</span> vsf: ST1-CMDR: VSF port 1/2 is down
</span></span><span style=display:flex><span>I 01/01/90 00:36:35 <span style=color:#ae81ff>03271</span> stacking: ST1-CMDR: Topology is a Standalone
</span></span><span style=display:flex><span>I 01/01/90 00:36:35 <span style=color:#ae81ff>03272</span> stacking: ST1-CMDR: Stack fragment active
</span></span><span style=display:flex><span>W 01/01/90 00:36:35 <span style=color:#ae81ff>03258</span> stacking: ST1-CMDR: Standby switch with Member ID <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>            removed due to loss of communication
</span></span><span style=display:flex><span>I 01/01/90 00:36:35 <span style=color:#ae81ff>04992</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> is down
</span></span><span style=display:flex><span>I 01/01/90 00:36:35 <span style=color:#ae81ff>04992</span> vsf: ST1-CMDR: VSF port 1/2 is in error state
</span></span></code></pre></div><p>Luckily, I&rsquo;ve got a 3rd switch ready to jump into the fray! After plugging the new one into the same port and waiting for it to reboot, we get some more log info.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>I 01/01/90 00:43:11 <span style=color:#ae81ff>00539</span> stacking: ST1-CMDR: Initial sync to standby starting
</span></span><span style=display:flex><span>I 01/01/90 00:43:10 <span style=color:#ae81ff>00256</span> ports: ST1-CMDR: Port 3/2 is reserved <span style=color:#66d9ef>for</span> VSF use
</span></span><span style=display:flex><span>W 01/01/90 00:43:10 <span style=color:#ae81ff>03270</span> stacking: ST1-CMDR: Topology is a Chain
</span></span><span style=display:flex><span>I 01/01/90 00:43:10 <span style=color:#ae81ff>02555</span> chassis: ST1-CMDR: Co-processor Ready
</span></span><span style=display:flex><span>I 01/01/90 00:43:08 <span style=color:#ae81ff>03125</span> mgr: ST1-CMDR: Startup configuration changed by SNMP.
</span></span><span style=display:flex><span>            New seq. number <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>I 01/01/90 00:43:08 <span style=color:#ae81ff>03803</span> chassis: ST1-CMDR: System Self test completed on
</span></span><span style=display:flex><span>            3/1-52
</span></span><span style=display:flex><span>W 01/01/90 00:43:08 <span style=color:#ae81ff>03270</span> stacking: ST1-CMDR: Topology is a Chain
</span></span><span style=display:flex><span>I 01/01/90 00:43:07 <span style=color:#ae81ff>03279</span> stacking: ST1-CMDR: Member <span style=color:#ae81ff>3</span> <span style=color:#f92672>(</span>e0071b-xxxxyy<span style=color:#f92672>)</span> chosen as
</span></span><span style=display:flex><span>            standby. Reason: Only available standby
</span></span><span style=display:flex><span>I 01/01/90 00:43:07 <span style=color:#ae81ff>04992</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> is up
</span></span><span style=display:flex><span>I 01/01/90 00:43:02 <span style=color:#ae81ff>04987</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> up: Peer has mac
</span></span><span style=display:flex><span>            e0071b-xxxxyy
</span></span><span style=display:flex><span>I 01/01/90 00:43:02 <span style=color:#ae81ff>04988</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> port 1/2 up: Peer validated
</span></span></code></pre></div><p>Looks like we&rsquo;re syncing the initial config which is always nice. The major problem that I can see here is that <code>Port 3/2 is reserved for VSF use</code>. Now, that first number indicates the chassis number, in VSF that would be the same as our <code>member</code> ID. Previously, we only had 1 and 2, now we appear to have a 3rd&mldr; Looking at the <code>show</code> command, we get the bad news. <em>The eagle eyed amongst you will also notice that I&rsquo;m masking the MAC address with y&rsquo;s for the 3rd switch. This will continue going forwards so that we know which switch is which.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># sh vsf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> VSF Domain ID    : <span style=color:#ae81ff>254</span>
</span></span><span style=display:flex><span> MAC Address      : 941882-xxxxxx
</span></span><span style=display:flex><span> VSF Topology     : Chain
</span></span><span style=display:flex><span> VSF Status       : Fragment Active
</span></span><span style=display:flex><span> Uptime           : 0d 0h 46m
</span></span><span style=display:flex><span> VSF MAD          : None
</span></span><span style=display:flex><span> VSF Port Speed   : 1G
</span></span><span style=display:flex><span> Software Version : WC.16.06.0006
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Mbr
</span></span><span style=display:flex><span> ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span> --- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span> *1  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>  e0071b-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>190</span> Missing
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>  e0071b-xxxxyy     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>128</span> Standby
</span></span></code></pre></div><p>Hmm&mldr; If you remember the running config output from earlier, you&rsquo;ll remember that the MAC address was set as a command. Let&rsquo;s give that a try.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf member 2 type &#34;JL260A&#34; mac-address e0071b-xxxxyy</span>
</span></span><span style=display:flex><span>This will save the current configuration. Continue <span style=color:#f92672>(</span>y/n<span style=color:#f92672>)</span>?  y
</span></span><span style=display:flex><span>A switch with the specified MAC address already exists.
</span></span></code></pre></div><p>Oops, no joy there. The list of options available for the VSF member isn&rsquo;t extensive either.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>VSF-Test<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e># vsf member 3</span>
</span></span><span style=display:flex><span> link                  Create an VSF link on the specified member.
</span></span><span style=display:flex><span> priority              Assign a priority to the specified VSF virtual chassis
</span></span><span style=display:flex><span>                       member.
</span></span><span style=display:flex><span> remove                Erase the VSF virtual chassis member configuration.
</span></span><span style=display:flex><span> shutdown              Shut down the VSF virtual chassis member.
</span></span><span style=display:flex><span> type                  Configure the family of the VSF member-switch being
</span></span><span style=display:flex><span>                       provisioned.
</span></span></code></pre></div><p>Now, as we&rsquo;re replacing a member that <em>should</em> have configuration on, we can&rsquo;t just remove member 2 and re-add it. Here&rsquo;s the cleanest way I&rsquo;ve found to do this (pro tip: for future break fixes, don&rsquo;t get this far. Have the break/fix engineer swapping out your kit give you the MAC of the new switch <em>before</em> plugging it in, that way you can do this without the extra steps).</p><ol><li><p>Remove the new member with <code>vsf member 3 remove</code>. You&rsquo;ll get a complaint from the switch but such is life.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>The specified VSF virtual chassis standby member will be removed and
</span></span><span style=display:flex><span>its configuration will be erased. The resulting configuration
</span></span><span style=display:flex><span>will be saved. The VSF standby member will be shutdown. Continue <span style=color:#f92672>(</span>y/n<span style=color:#f92672>)</span>? y
</span></span></code></pre></div></li><li><p>Now you should be able to run the <code>vsf member 2 type "JL260A" mac-address e0071b-xxxxyy</code> command that failed earlier. Your status will show as <code>provisioned</code> in <code>sh vsf</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span>--- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span>*1  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>  e0071b-xxxxyy     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>190</span> Provisioned
</span></span></code></pre></div></li><li><p>Have a kind human (or break/fix engineer, whatever is available) hard reboot the new switch. Not ideal, I&rsquo;m aware. Short of separating the 2, manually connecting to the new switch and factory resetting it, this is the best way I&rsquo;ve found.</p></li><li><p>Welcome your new stack member into the fold!</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>I 01/01/90 01:04:41 <span style=color:#ae81ff>00539</span> stacking: ST1-CMDR: Initial sync to standby starting
</span></span><span style=display:flex><span>I 01/01/90 01:04:40 <span style=color:#ae81ff>00256</span> ports: ST1-CMDR: Port 2/2 is reserved <span style=color:#66d9ef>for</span> VSF use
</span></span><span style=display:flex><span>W 01/01/90 01:04:40 <span style=color:#ae81ff>03270</span> stacking: ST1-CMDR: Topology is a Chain
</span></span><span style=display:flex><span>I 01/01/90 01:04:40 <span style=color:#ae81ff>02555</span> chassis: ST1-CMDR: Co-processor Ready
</span></span><span style=display:flex><span>I 01/01/90 01:04:38 <span style=color:#ae81ff>03803</span> chassis: ST1-CMDR: System Self test completed on
</span></span><span style=display:flex><span>            2/1-52
</span></span><span style=display:flex><span>W 01/01/90 01:04:38 <span style=color:#ae81ff>03270</span> stacking: ST1-CMDR: Topology is a Chain
</span></span><span style=display:flex><span>I 01/01/90 01:04:38 <span style=color:#ae81ff>03125</span> mgr: ST1-CMDR: Startup configuration changed by SNMP.
</span></span><span style=display:flex><span>            New seq. number <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>I 01/01/90 01:04:38 <span style=color:#ae81ff>03279</span> stacking: ST1-CMDR: Member <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>e0071b-xxxxyy<span style=color:#f92672>)</span> chosen as
</span></span><span style=display:flex><span>            standby. Reason: Only available standby
</span></span><span style=display:flex><span>I 01/01/90 01:04:38 <span style=color:#ae81ff>04992</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> is up
</span></span><span style=display:flex><span>I 01/01/90 01:04:33 <span style=color:#ae81ff>04987</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> up: Peer has mac
</span></span><span style=display:flex><span>            e0071b-xxxxyy
</span></span><span style=display:flex><span>I 01/01/90 01:04:33 <span style=color:#ae81ff>04988</span> vsf: ST1-CMDR: VSF link <span style=color:#ae81ff>1</span> port 1/2 up: Peer validated
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span> --- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span> *1  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>  e0071b-xxxxyy     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>190</span> Standby Booting
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ID  MAC Address       Model                                 Pri Status
</span></span><span style=display:flex><span> --- ----------------- ------------------------------------- --- ---------------
</span></span><span style=display:flex><span> *1  941882-xxxxxx     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>200</span> Commander
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>  e0071b-xxxxyy     Aruba JL260A 2930F-48G-4SFP Switch    <span style=color:#ae81ff>190</span> Standby
</span></span></code></pre></div><p>Now you can continue on with your day, safe in the knowledge that the <strong>P1, 4 Hour Fix</strong> call you were working on is resolved. Good Job!</p><h3 id=word-to-the-wise>Word To The Wise<a hidden class=anchor aria-hidden=true href=#word-to-the-wise>#</a></h3><p>The smart way to do this is to get the break/fix engineer to phone you before they get to the site. Then, they can provide you with the MAC address from the side of the box, as seen below.</p><p>That way, you can run the <code>vsf member 2 type "JL260A" mac-address e0071b-xxxxyy</code> command well before there is ever the mention of a 3rd member.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dangerous.tech/tags/hpe/>Hpe</a></li><li><a href=https://dangerous.tech/tags/aruba/>Aruba</a></li><li><a href=https://dangerous.tech/tags/vsf/>Vsf</a></li><li><a href=https://dangerous.tech/tags/stacking/>Stacking</a></li><li><a href=https://dangerous.tech/tags/switches/>Switches</a></li></ul><nav class=paginav><a class=prev href=https://dangerous.tech/znc--docker-a-containerized-irc-bouncer/><span class=title>« Prev</span><br><span>ZNC + Docker - A Containerized IRC Bouncer</span>
</a><a class=next href=https://dangerous.tech/the-magic-of-upgrading-pip-packages/><span class=title>Next »</span><br><span>The Magic of Upgrading Pip Packages</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on x" href="https://x.com/intent/tweet/?text=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F&amp;url=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f&amp;hashtags=hpe%2caruba%2cvsf%2cstacking%2cswitches"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f&amp;title=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F&amp;summary=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F&amp;source=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f&title=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on whatsapp" href="https://api.whatsapp.com/send?text=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F%20-%20https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on telegram" href="https://telegram.me/share/url?text=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F&amp;url=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Configuring VSF (Virtual Switching Framework) Stacking on the HPE/Aruba 2930F on ycombinator" href="https://news.ycombinator.com/submitlink?t=Configuring%20VSF%20%28Virtual%20Switching%20Framework%29%20Stacking%20on%20the%20HPE%2fAruba%202930F&u=https%3a%2f%2fdangerous.tech%2fconfiguring-vsf-virtual-switching-framework-stacking-on-the-hpe%2faruba-2930f%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://dangerous.tech/>Dangerous.Tech</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>